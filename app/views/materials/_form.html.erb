<%= simple_form_for(@material, url: materials_path, method: :post, html: { multipart: true, id: "fabric-form" }) do |f| %>

  <!-- Image Upload -->
  <div class="image-upload">
    <label for="material_photo">
      <div class="upload-box">
        <i class="fas fa-plus"></i>
        <p>Upload Image</p>
      </div>
    </label>
    <%= f.input :photo, label: false, as: :file, input_html: { id: "material_photo", style: "display: none;" } %>
  </div>

  <!-- Fabric Name & Quantity -->
  <div class="fabric-name">
    <h2>NAME</h2>
    <p>QUANTITY: ...M</p>
  </div>

  <!-- Details Section -->
  <div class="details-box">
    <h3>DETAILS</h3>

    <%= f.input :fabric_type, label: "Type" %>
    <%= f.input :fiber_composition, label: "Fiber" %>

    <div class="input-group dimensions">
      <%= f.input :length, label: "L (m)", input_html: { step: 0.01 } %>
      <%= f.input :width, label: "W (cm)", input_html: { step: 0.1 } %>
      <%= f.input :weight, label: "G/MÂ²", input_html: { step: 0.1 } %>
    </div>

    <%= f.input :color, label: "Color" %>
    <%= f.input :texture, label: "Texture" %>
    <%= f.input :origin, label: "Origin" %>
    <%= f.input :supplier, label: "Supplier" %>
    <%= f.input :product_code, label: "Product Code" %>
    <%= f.input :purchase_location, label: "Purchase Location" %>
    <%= f.input :purchase_date, label: "Purchase Date", as: :date %>
    <%= f.input :price_per_meter, label: "Price per Meter", input_html: { step: 0.01 } %>
    <%= f.input :certifications, label: "Certifications" %>
    <%= f.input :notes, label: "Notes", as: :text %>
  </div>

  <!-- Buttons -->
  <div class="button-group">
    <button type="button" id="add-fabric-btn" class="add-fabric">ADD FABRIC</button>
    <%= link_to "CANCEL", materials_path, class: "cancel-btn" %>
  </div>

<% end %>

<script>
  document.getElementById("add-fabric-btn").addEventListener("click", async () => {
    const formData = new FormData(document.getElementById("fabric-form"));

    const response = await fetch("/materials", {
      method: "POST",
      body: formData
    });

    if (response.ok) {
      const material = await response.json();

      // Call AI function to process the material data
      fetch(`/materials/${material.id}/process_ai`, {
        method: "POST"
      }).then(() => {
        window.location.href = `/materials/${material.id}`;
      });
    }
  });
</script>
