<div class="materials-show-container">
  <h1 class="hr-lines">E C O W A V E</h1>

  <% if @material.photo.attached? %>
    <%= cl_image_tag @material.photo.key, class: "material-photo", crop: :fill, alt: "Fabric Photo" %>
  <% end %>

  <!-- Fabric Title and Quantity -->
  <h2 class="fabric-title">
    <%= @material.fabric_type.presence || "Not Provided" %>
  </h2>
  <p class="fabric-quantity">
    QUANTITY:
    <% if @material.length.present? %>
      <%= "#{@material.length}m" %>
    <% else %>
      Not Provided
    <% end %>
  </p>

  <!-- Summary Paragraph -->
  <p class="fabric-summary">
    <%= @material.summary.presence || "No summary provided." %>
  </p>

  <!-- Environmental Score Heading -->
  <h2 class="env-score-heading">ENVIRONMENTAL SCORE</h2>

  <!-- Environmental Metrics Circular Bars -->
  <div class="materials-show-flex-wrapper">
    <!-- WATER USAGE -->
    <div class="materials-show-single-chart">
      <% water = @material.water_usage %>
      <% water_threshold = 2000.0 %> <!-- "Bad" threshold for water usage -->
      <% water_ratio = if water.present?
                        ratio = (water / water_threshold) * 100
                        ratio = 100 if ratio > 100
                        ratio
                      else
                        0
                      end
      %>

      <svg viewBox="0 0 36 36" class="materials-show-circular-chart materials-show-water-chart">
        <path class="materials-show-circle-bg"
          d="M18 2.0845
             a 15.9155 15.9155 0 0 1 0 31.831
             a 15.9155 15.9155 0 0 1 0 -31.831"
        />
        <path class="materials-show-circle"
          stroke-dasharray="<%= water_ratio.round(1) %>, 100"
          d="M18 2.0845
             a 15.9155 15.9155 0 0 1 0 31.831
             a 15.9155 15.9155 0 0 1 0 -31.831"
        />
        <text x="18" y="20.35" class="materials-show-percentage">
          <% if water.present? %>
            <%= "#{water.round(1)} L/m²" %>
          <% else %>
            Not Provided
          <% end %>
        </text>
      </svg>
      <p class="materials-show-chart-label">Water Usage</p>
    </div>

    <!-- CO2 EMISSIONS -->
    <div class="materials-show-single-chart">
      <% co2_val = @material.co2 %>
      <% co2_threshold = 2.0 %> <!-- "Bad" threshold for CO₂ -->
      <% co2_ratio = if co2_val.present?
                       ratio = (co2_val / co2_threshold) * 100
                       ratio = 100 if ratio > 100
                       ratio
                     else
                       0
                     end
      %>

      <svg viewBox="0 0 36 36" class="materials-show-circular-chart materials-show-co2-chart">
        <path class="materials-show-circle-bg"
          d="M18 2.0845
             a 15.9155 15.9155 0 0 1 0 31.831
             a 15.9155 15.9155 0 0 1 0 -31.831"
        />
        <path class="materials-show-circle"
          stroke-dasharray="<%= co2_ratio.round(1) %>, 100"
          d="M18 2.0845
             a 15.9155 15.9155 0 0 1 0 31.831
             a 15.9155 15.9155 0 0 1 0 -31.831"
        />
        <text x="18" y="20.35" class="materials-show-percentage">
          <% if co2_val.present? %>
            <%= "#{co2_val.round(2)} kg/m²" %>
          <% else %>
            Not Provided
          <% end %>
        </text>
      </svg>
      <p class="materials-show-chart-label">CO₂ Emissions</p>
    </div>

    <!-- ELECTRICITY USED -->
    <div class="materials-show-single-chart">
      <% elec = @material.electricity_used %>
      <% elec_threshold = 1.0 %> <!-- "Bad" threshold for electricity (1 kWh/m²) -->
      <% elec_ratio = if elec.present?
                        ratio = (elec / elec_threshold) * 100
                        ratio = 100 if ratio > 100
                        ratio
                      else
                        0
                      end
      %>

      <svg viewBox="0 0 36 36" class="materials-show-circular-chart materials-show-electricity-chart">
        <path class="materials-show-circle-bg"
          d="M18 2.0845
             a 15.9155 15.9155 0 0 1 0 31.831
             a 15.9155 15.9155 0 0 1 0 -31.831"
        />
        <path class="materials-show-circle"
          stroke-dasharray="<%= elec_ratio.round(1) %>, 100"
          d="M18 2.0845
             a 15.9155 15.9155 0 0 1 0 31.831
             a 15.9155 15.9155 0 0 1 0 -31.831"
        />
        <text x="18" y="20.35" class="materials-show-percentage">
          <% if elec.present? %>
            <%= "#{elec.round(2)} kWh/m²" %>
          <% else %>
            Not Provided
          <% end %>
        </text>
      </svg>
      <p class="materials-show-chart-label">Electricity Used</p>
    </div>
  </div>

  <!-- Material Details Section -->
  <div class="material-info">
    <h2>Details</h2>
    <ul>
      <li>Fiber Composition: <%= @material.fiber.presence || "Not Provided" %></li>
      <li>Length: <%= @material.length.present? ? "#{@material.length}m" : "Not Provided" %></li>
      <li>Width: <%= @material.width.present? ? "#{@material.width}cm" : "Not Provided" %></li>
      <li>Weight (G/M²): <%= @material.grams_per_square_meter.present? ? @material.grams_per_square_meter : "Not Provided" %></li>
      <li>Color: <%= @material.colour.presence || "Not Provided" %></li>
      <li>Texture: <%= @material.texture.presence || "Not Provided" %></li>
      <li>Origin: <%= @material.origin.presence || "Not Provided" %></li>
      <li>Supplier: <%= @material.supplier.presence || "Not Provided" %></li>
      <li>Product Code: <%= @material.product_code.presence || "Not Provided" %></li>
      <li>Purchase Location: <%= @material.purchase_location.presence || "Not Provided" %></li>
      <li>Purchase Date: <%= @material.purchase_date.present? ? @material.purchase_date : "Not Provided" %></li>
      <li>Price per Meter: <%= @material.price_per_meter.present? ? @material.price_per_meter : "Not Provided" %></li>
      <li>Certifications: <%= @material.certifications.presence || "Not Provided" %></li>
      <li>Notes: <%= @material.notes.present? ? @material.notes : "Not Provided" %></li>
    </ul>
  </div>

  <!-- Back / Add to Project -->
  <%= link_to "Back", materials_path, class: "btn-back" %>
  <% if @project %>
    <%= link_to project_project_material_path(@project, @material), class: "btn-add-material" do %>
      <i class="fa-solid fa-plus"></i> Add to Project
    <% end %>
  <% else %>
    <p>Select a project to add this material.</p>
    <%= link_to "Select a Project", projects_path, class: "btn-add-material" %>
  <% end %>
</div>
