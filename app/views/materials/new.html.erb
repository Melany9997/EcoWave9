<h1 class="hr-lines">E C O W A V E</h1>

<%= simple_form_for(@material, url: materials_path, html: { multipart: true, id: "fabric-form" }) do |f| %>
  <!-- Image Upload Circle -->
  <div class="image-upload">
    <label for="material_photo">
      <div class="upload-box">
        <% if @material.photo.attached? %>
          <%= image_tag @material.photo, class: "preview-img" %>
        <% else %>
          <i class="fas fa-plus"></i>
          <p>Upload Image</p>
        <% end %>
      </div>
    </label>
    <%= f.input :photo, label: false, as: :file, input_html: { id: "material_photo", class: "d-none" } %>
  </div>

  <!-- Dynamic Quantity & Fabric Type Display -->
  <div class="fabric-name">
    <h2 id="fabric-type-display"><%= @material.fabric_type.presence || "FABRIC TYPE" %></h2>
    <p>
      QUANTITY: <span id="quantity-display"><%= @material.length || '...' %></span>m
    </p>
  </div>

  <!-- Details Section -->
  <div class="details-box">
    <h3>DETAILS</h3>

    <%= f.input :fabric_type, label: "Fabric Type", input_html: { id: "material_fabric_type" } %>
    <%= f.input :fiber, label: "Fiber Composition" %>

    <div class="input-group dimensions">
      <%= f.input :length, label: "Length (m)", input_html: { step: 0.01, id: "material_length" } %>
      <%= f.input :width, label: "Width (cm)", input_html: { step: 0.1 } %>
      <%= f.input :grams_per_square_meter, label: "G/MÂ²", input_html: { step: 0.1 } %>
    </div>

    <%= f.input :colour, label: "Colour" %>
    <%= f.input :texture, label: "Texture" %>
    <%= f.input :origin, label: "Origin" %>
    <%= f.input :supplier, label: "Supplier" %>
    <%= f.input :product_code, label: "Product Code" %>
    <%= f.input :purchase_location, label: "Purchase Location" %>
    <%= f.input :purchase_date, label: "Purchase Date", as: :date %>
    <%= f.input :price_per_meter, label: "Price per Meter", input_html: { step: 0.01 } %>
    <%= f.input :certifications, label: "Certifications" %>
    <%= f.input :notes, label: "Notes", as: :text %>
  </div>

  <!-- Form Buttons -->
  <div class="button-group">
    <%= f.button :button, "ADD FABRIC", type: :submit, class: "add-fabric" %>
    <%= link_to "CANCEL", materials_path, class: "cancel-btn" %>
  </div>
<% end %>
<br>
    <br>
    <br>
    <br>
<style>
  .image-upload .upload-box {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f5f5f5;
  }

  .upload-box i {
    font-size: 2rem;
    color: #555;
  }

  .preview-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .fabric-name {
    margin-top: 20px;
  }

  .details-box {
    margin-top: 30px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
  }

  .details-box .dimensions {
    display: flex;
    gap: 10px;
  }

  .button-group {
    margin-top: 20px;
    display: flex;
    gap: 10px;
  }
</style>

<script>
  // Image preview functionality
  const photoInput = document.getElementById('material_photo');
  if (photoInput) {
    photoInput.addEventListener('change', function(e) {
      const [file] = e.target.files;
      if (file) {
        const preview = document.querySelector('.upload-box');
        preview.innerHTML = `<img src="${URL.createObjectURL(file)}" class="preview-img">`;
      }
    });
  }

  // Dynamic quantity update
  const lengthInput = document.getElementById('material_length');
  if (lengthInput) {
    lengthInput.addEventListener('input', function(e) {
      const quantityDisplay = document.getElementById('quantity-display');
      quantityDisplay.textContent = e.target.value || '...';
    });
  }

  // Dynamic fabric type update
  const fabricTypeInput = document.getElementById('material_fabric_type');
  if (fabricTypeInput) {
    fabricTypeInput.addEventListener('input', function(e) {
      const fabricTypeDisplay = document.getElementById('fabric-type-display');
      fabricTypeDisplay.textContent = e.target.value || 'FABRIC TYPE';
    });
  }
</script>
